{% extends 'base.html' %}

{% block content %}
<h1>Edit Recipe</h1>

<form method="POST" action="{% url 'update_recipe' %}">
    {% csrf_token %}
    <ul>
        {% for recipe in recipes %}
        <li>
            <input type="checkbox" name="recipe_id" value="{{ recipe.id }}">
            {{ recipe.name }}
        </li>
        {% endfor %}
    </ul>
    <button type="button" id="edit-button">Edit selected</button>
</form>

<!--modal-->
<div id="edit-modal" style="display: none;">
    <form id="edit-form" method="POST" action="{% url 'update_recipe' %}">
        {% csrf_token %}
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" value="{{ recipe.name }}">

        <label for="ingredients">Ingredients:</label>
        <textarea id="ingredients" name="ingredients">{{ recipe.ingredients }}</textarea>

        <label for="instructions">Instructions:</label>
        <textarea id="instructions" name="instructions">{{ recipe.instructions }}</textarea>

        <label for="recipe-category">Category:</label>
        <select id="recipe-category" name="category">
            <option value="starters">Starters</option>
            <option value="mains">Mains</option>
            <option value="desserts">Desserts</option>
        </select>

        <button type="submit">Save</button>
        <button type="button" id="cancel-edit">Cancel</button>
    </form>
</div>

<div id="" overlay style="display: none; position: fixed; width: 100%;z-index: 999"></div>

<script> 
    const editButton=document.getElementById('edit-button'); 
    const modal=document.getElementById('edit-modal');
    const overlay=document.getElementById('overlay'); 
    const cancelEdit=document.getElementById('cancel-edit'); 
    const editForm=document.getElementById('edit-form'); 
    const recipeName=document.getElementById('name'); 
    const recipeIngredients=document.getElementById('ingredients'); 
    const recipeInstructions=document.getElementById('instructions'); 
    const recipeCategory=document.getElementById('category'); 
    
    editButton.addEventListener('click', ()=> {
        const selectedCheckbox = document.querySelector('input[name="recipe_id"]:checked');
            if (!selectedCheckbox) {
                alert('Please select a recipe to edit');
                return;
            }
        

        const recipeId = selectedCheckbox.value;

        fetch(`/recipe/${recipeId}`)
            .then(response => response.json())
            .then(data => {
                recipeName.value = data.name;
                recipeIngredients.value = data.ingredients;
                recipeInstructions.value = data.instructions;
                recipeCategory.value = data.category;

                editForm.action = `/edit/${recipeId}`;

                modal.style.display = 'block';
                overlay.style.display = 'block';

            });

    });

    cancelEdit.addEventListener('click', () => {
        modal.style.display = 'none';
        overlay.style.display = 'none';
    });
</script>


{% endblock %}