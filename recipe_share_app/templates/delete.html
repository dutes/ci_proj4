{% extends 'base.html' %}

{% block content %}
<h1>Delete Recipes</h1>
<!--list with delte buttons-->
<ul class="collection">
    {% for recipe in recipes %}
    <li class="collection-item avatar">
        <img src="{{ recipe.image.url }}" alt="{{ recipe.name }}">
        <span class="title">{{ recipe.name }}</span>
        <button class="btn red waves-effect waves-light delete-button" data-recipe-id="{{ recipe.id }}">Delete</button>
    </li>
    {% endfor %}
</ul>

<!--modal for delete confirmation-->
<div id="delete-modal" class="modal">
    <div class="modal-content">
        <h4>Confirm Delete</h4>
        <p>Are you sure you want to delete this recipe?</p>
    </div>
    <div class="modal-footer">
        <button id="confirm-delete" class="btn waves-effect waves-light">Yes</button>
        <button id="cancel-delete" class="btn red lighten-1">No</button>
    </div>
</div>

<form id="delte-form" method="POST" action="{% url 'delete' %}">
    {% csrf_token %}
    <input type="hidden" name="recipe_id" id="recipe-id-to-delete">
</form>

<script>
    document.addEventListener('DOMContentLoaded', function(){
        var modalElems = document.querySelectorAll('.modal');
        M.Modal.init(modalElems);

        const deleteButtons = document.querySelectorAll('.delete-button');
        const deleteModal = M.Modal.init(document.getElementById('delete-modal'));
        const deleteForm = document.getElementById('delete-form');
        const recipeIdInput = document.getElementById('recipe-id-to-delete');
        const confirmDelete = document.getElementById('confirm-delete');


        let selectedRecipeId = null;

        deleteButtons.forEach(button => {
            button.addEventListener('click',() => {
                selectedRecipeId = button.getAttribute('data-recipe-id');
                recipeIdInput.value = selectedRecipeId;
                deleteModal.open();
            });
        });


    confirmDelete.addEventListener('click', () => {
        if (selectedRecipeId) {
            deleteModal.close();
            deleteForm.submit();
            }
        });
    });

</script>
{% endblock %}