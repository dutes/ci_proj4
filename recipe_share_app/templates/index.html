{% extends 'base.html' %}

{% block content %}
<div class="container text-center">
    <h1>Welcome to the Recipe Sharing App!</h1>
    {% if user.is_authenticated %}
        <h2> Welcome, {{ user.username }}! Please contribute by adding a recipe.</h2>
    {% else %}
        <p>If you don't have an account, please create one to be able to add, view or delete recipes. Otherwise, login to contribute</p>

<!-- toast messages -->
{% if messages %}
<div aria-live="polite" aria-tomic="true" class="position-relative">
    <div class="toast-container position-absolute top-0 start-0 p-3">
        {% for message in messages %}
        <div class="toast align-items-center text-white bg-success border-0 show" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">
                    {{ message }}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>  
{% endif %}

<!-- buttons to open login and create views-->
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#loginModal">Login</button>
         <button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#signupModal">Sign Up</button>
    {% endif %}
</div>

<!-- Login Modal -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered"> <!-- Centered modal -->
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header bg-primary text-white"> <!-- Added background color -->
                <h5 class="modal-title" id="loginModalLabel">Login</h5>
                <button type="button" class="btn-close text-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <!-- Modal Body -->
            <div class="modal-body">
                <form method="post" action="{% url 'index' %}" class="p-3">
                    {% csrf_token %}
                    
                    <!-- Username Field -->
                    <div class="mb-3">
                        <label for="id_login-username" class="form-label fw-semibold">Username</label>
                        <input type="text" name="login-username" class="form-control" id="id_login-username" 
                               placeholder="Enter your username" required>
                    </div>
                    
                    <!-- Password Field -->
                    <div class="mb-3">
                        <label for="id_login-password" class="form-label fw-semibold">Password</label>
                        <input type="password" name="login-password" class="form-control" id="id_login-password" 
                               placeholder="Enter your password" required>
                    </div>
                    
                    <!-- Submit and Cancel Buttons -->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="submit" name="login" class="btn btn-primary w-100">Login</button>
                        <button type="button" class="btn btn-secondary w-100" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer text-center">
                <p class="small text-muted w-100">
                    Don't have an account? <a href="#" class="text-primary" data-bs-toggle="modal" data-bs-target="#signupModal">Sign up here</a>
                </p>
            </div>
        </div>
    </div>
</div>


<!-- Sign-up Modal -->
<div class="modal fade" id="signupModal" tabindex="-1" aria-labelledby="signupModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="signupModalLabel">Sign Up</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="{% url 'index' %}" id="signup-form">
                    {% csrf_token %}
                    <!--username-->
                    <div class="mb-3">
                        <label for="id_signup-username" class="form-label">Username</label>
                        <input type="text" name="signup-username" class="form-control" id="id_signup_username"
                            placeholder="Choose a username" required>
                    </div>
                    <!--password-->
                    <!--{{ signup_form.as_p }}  Ensures prefixed form fields are rendered correctly -->
                     <div class="mb-3">
                        <label for="id_signup-password1"class="form-label"> Password</label>
                        <input type=""password name="signup-password1" class="form-control" id="id_signuup-password1"
                            placeholder="Enter a strong password" required>
                     </div>
                     <!--password confirmation-->
                     <div class="mb-3">
                        <label for="id_signup-password2"class="form-label"> Password</label>
                        <input type=""password name="signup-password2" class="form-control" id="id_signuup-password2"
                            placeholder="Re-enter your password" required>
                        <div id="password-feedback" class="form-text text-danger"></div>
                     </div>
                    <div class="text-end">
                        <button type="submit" name="signup" class="btn btn-primary">Sign Up</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    //password validation feedback
    document.addEventListener("DOMContentLoaded", function (){
        const passwordField=document.getElementById("id_signup-password1");
        const passwordConfirmationField = document.getElementById("id_signup-password2");
        const feedback = document.getElementById("password-validation-feedback");

        if (passwordField && passwordConfirmationField) {
            passwordField.addEventListener("input", validatePasswords);
            passwordConfirmationField.addEventListener("input", validatePasswords);

            function validatePasswords() {
                const password = passwordField.value;
                const confirmPassword=passwordConfirmationField.value;
            
                if (password.length < 8) {
                    feedback.textContent = "Password must be at least 8 characters long";
                } else if (password !== confirmPassword) {
                    feedback.textContent = "Passwords must match";
                } else {
                    feedback.textContent = "";
                }
            }
        }
        //toast dismissal
        const toastElements = document.querySelectorAll('.toast');
        toastElements.forEach(toastEl => {
            const toast = new bootstrap.Toast(toastEl, { delay: 5000}); //delay dismiss for 5sec
            toast.show();
        })   
    });
</script>
{% endblock %}