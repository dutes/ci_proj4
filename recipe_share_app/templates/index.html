{% extends 'base.html' %}

{% block content %}
<div class="container text-center">
    <h1> Welcome to the Recipe Share App!</h1>
    {% if user.is_authenticated %}
        <h2>Welcome, {{ user.username }}! Please contribute by adding a recipe.</h2>
    {% else %}
        <div style="max-width: 800px; margin:0 auto; padding: 20px; text-align: center;">
            <p>Welcome to the Recipe Sharing Platform, where the aroma of creativity meets the warmth of togetherness.</P>
            <p>Cooking isn’t just about combining ingredients; it’s about crafting moments, sparking smiles, and sharing love with every bite. 
                Whether it’s a family dinner, a celebration with friends, or a quiet moment for yourself, the joy of creating something 
                delicious is unmatched.</p>
            <p>Here, you’ll find a treasure trove of recipes to inspire your inner chef and delight your loved ones. 
                After all, a shared meal is more than just food on a plate—it’s a heartfelt connection on the table. 
                Let’s cook, share, and savor the simple joys of life, one recipe at a time.</p>
            <h2>Log in or sign up to add, view, edit, or delete a recipe.</h2>
        </div>
<!-- toast messages -->
        {% if messages %}
        <div aria-live="polite" aria-atomic="true" class="position-relative">
            <div class="toast-container position-absolute top-0 start-0 p-3">
                {% for message in messages %}
                <div class="toast align-items-center test-white bg-success border-0 show" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="d-flex">
                        <div class="toast-body">{{ message }}</div>
                        <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!--- buttons to open login and signup modals -->
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#loginModal">Login</button>
        <button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#signupModal">Sign Up</button>
    {% endif %}
</div>

<!---login modal-->
<div class="modal fade" id="loginModal" tabindex='-1' aria-labelledby="loginModalLabel" aria-hidden='true'
    data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <!-- Unified Header -->
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="loginModalLabel">Login</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <!-- Modal Body -->
            <div class='modal-body'>
                <form method="post" action="{% url 'index' %}" class="p-3" id="login-form">
                    {% csrf_token %}
                    <!-- Username Field -->
                    <div class="mb-3">
                        <label for="id_login-username" class="form-label fw-semibold">Username</label>
                        <input type="text" name="login-username" id="id_login-username" class="form-control"
                            placeholder="Enter your username" autocomplete="username" required>
                    </div>
                    <!-- Password Field -->
                    <div class="mb-3">
                        <label for="id_login-password" class="form-label">Password</label>
                        <input type="password" name="login-password" id="id_login-password" class="form-control"
                            placeholder="Enter your password" autocomplete="new-password" required>
                    </div>
                    <!-- Buttons -->
                    <div class="d-flex justify-content-end gap-2">
                        <button type="submit" name="login" class="btn btn-primary w-50">Login</button>
                        <button type="button" class="btn btn-secondary w-50" data-bs-dismiss="modal">Cancel</button>
                    </div>
                    <!-- Footer -->
                    <div class="modal-footer text-center">
                        <p class="small text-muted w-100">
                            Don't have an account? <a href="#" data-bs-dismiss="modal" data-bs-toggle="modal"
                                data-bs-target="#signupModal">Sign Up</a>
                        </p>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!---signup modal-->
<div class="modal fade" id="signupModal" tabindex="-1" aria-labelledby="signupModalLabel" aria-hidden="true"
data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="signupModalLabel">Sign Up</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form method="post" action="{% url 'index' %}" id="signup-form">
                        {% csrf_token %}
                        <!---username field-->
                        <div class="mb-3">
                            <label for="id_signup-username" class="form-label fw-semibold">Username</label>
                            <input type="text" name="signup-username" id="id_signup-username" class="form-control" 
                            placeholder="Enter your username" autocomplete="username" required>
                            <div id="username-feedback" class="form-text text-danger"></div>
                        </div>
                        <!---passwords-->
                        <!---password1 field-->
                        <div class="mb-3">
                            <label for="signup-password1" class="form-label">Password</label>
                            <input type="password" name="signup-password1" id="signup-password1" class="form-control"
                            placeholder="Enter your password" autocomplete="new-password" required>
                        </div>
                        <!---password2 field-->
                        <div class="mb-3">
                            <label for="signup-password2" class="form-label">Confirm Password</label>
                            <input type="password" name="signup-password2" id="signup-password2" class="form-control"
                            placeholder="Confirm your password" autocomplete="new-password" required>
                            <div id="password2-feedback" class="form-text text-danger"></div>
                            <div id="password1-feedback" class="form-text text-danger"></div>
                        </div>
                        <div class="text-end">
                            <button type="submit" name="signup" id="signup-submit" class="btn btn-primary" disabled>Sign Up</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const signupForm = document.getElementById("signup-form");
        const signupModal = document.getElementById("signupModal");
        const usernameField = document.getElementById("id_signup-username");
        const usernameFeedback = document.getElementById("username-feedback");
        const password1Field = document.getElementById("signup-password1");
        const password2Field = document.getElementById("signup-password2");
        const password1Feedback = document.getElementById("password1-feedback");
        const password2Feedback = document.getElementById("password2-feedback");
        const submitButton = document.getElementById("signup-submit");
    
        const USERNAME_REGEX = /^[a-zA-Z0-9_]{5,20}$/;
    
        function validateForm() {
            let isValid = true;
    
            // Username validation
            const username = usernameField.value.trim();
            if (username.length < 5) {
                usernameFeedback.textContent = "Username should be at least 5 characters.";
                isValid = false;
            } else if (username.length > 20) {
                usernameFeedback.textContent = "Username should be under 20 characters.";
                isValid = false;
            } else if (!USERNAME_REGEX.test(username)) {
                usernameFeedback.textContent = "Only letters, numbers, and underscores are allowed.";
                isValid = false;
            } else {
                usernameFeedback.textContent = "";
            }
    
            // Password validation
            const password1 = password1Field.value.trim();
            const password2 = password2Field.value.trim();
    
            if (password1.length < 8) {
                password1Feedback.textContent = "Password should be at least 8 characters.";
                isValid = false;
            } else {
                password1Feedback.textContent = "";
            }
    
            if (password1 !== password2) {
                password2Feedback.textContent = "Passwords do not match.";
                isValid = false;
            } else {
                password2Feedback.textContent = "";
            }
    
            // Enable or disable the submit button
            submitButton.disabled = !isValid;
        }
    
        usernameField.addEventListener("input", validateForm);
        password1Field.addEventListener("input", validateForm);
        password2Field.addEventListener("input", validateForm);
    
        signupModal.addEventListener("hidden.bs.modal", () => {
            signupForm.reset();
            usernameFeedback.textContent = "";
            password1Feedback.textContent = "";
            password2Feedback.textContent = "";
            submitButton.disabled = true;
        });
    });
    
    
    

  //toast messages
  const toastContainer = document.querySelector(".toast-container");
  if (toastContainer) {
      const toastElements = toastContainer.querySelectorAll(".toast");
      //if toast is present, auto dismiss after 5 seconds
      if (toastElements.length) {
          const toast = new bootstrap.Toast(toastElements[0], {delay: 5000});
          toast.show();
      }
      //clear old toast
      setTimeout(() => {
          while (toastContainer.firstChild) {
              toastContainer.removeChild(toastContainer.firstChild);
          }
      }, 3500);

  }
</script>
{% endblock %}
